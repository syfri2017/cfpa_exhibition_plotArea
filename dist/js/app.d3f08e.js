webpackJsonp([1],[,,,,,,,function(e,t,a){"use strict";function n(e){if(null===e||void 0===e)return e;var t=toString.call(e),a=["valueOf","toLocaleString","toString","constructor"],i=void 0,o=void 0,r=void 0,s=void 0,l=void 0;if("[object Date]"===t)return new Date(e.getTime());if("[object Array]"===t)for(i=e.length,s=[];i--;)s[i]=n(e[i]);else if("[object Object]"===t&&e.constructor===Object){s={};for(l in e)s[l]=n(e[l]);if(a)for(o=a.length;o--;)r=a[o],e.hasOwnProperty(r)&&(s[r]=e[r])}return s||e}function i(e){return"[object Array]"===toString.call(e)}function o(e,t){return null==e||!t&&""===e||i(e)&&0===e.length}t.b=n,t.c=o;var r=a(74),s=a.n(r),l=a(76),c=a.n(l),u=a(28),d=a.n(u),h=a(17),p=a(57);t.a={secondToStringHmTime:function(e){var t=e/3600,a="-",n="-";t>0&&(a=parseInt(t));var i=parseInt(60*(t-a));return i>=0&&(n=i<10?"0"+i:i),a+":"+n},stringHmTimeToSecond:function(e){var t=0;if(null!==e&&""!==e){var a=e.toString().split(":");t=3600*parseInt(a[0])+60*parseInt(a[1])}return t},resetTreeData:function(e){var t=!0,a=!1,n=void 0;try{for(var i,o=d()(e);!(t=(i=o.next()).done);t=!0){var r=i.value;r.selected=!1,r.checked=!1,r.childrenCheckedStatus=0,r.children&&r.children.length&&this.resetTreeData(r.children)}}catch(e){a=!0,n=e}finally{try{!t&&o.return&&o.return()}finally{if(a)throw n}}},getNodes:function(e,t){var a=[],n=!0,i=!1,o=void 0;try{for(var r,l=d()(t);!(n=(r=l.next()).done);n=!0){var u=r.value,h=!0,p=!0,f=!1,g=void 0;try{for(var m,v=d()(s()(e));!(p=(m=v.next()).done);p=!0){var S=m.value,y=c()(S,2),w=y[0],_=y[1];if(u[w]!==_){h=!1;break}}}catch(e){f=!0,g=e}finally{try{!p&&v.return&&v.return()}finally{if(f)throw g}}h&&a.push(u),u.children&&u.children.length&&(a=a.concat(this.getNodes(e,u.children)))}}catch(e){i=!0,o=e}finally{try{!n&&l.return&&l.return()}finally{if(i)throw o}}return a},getHttpUrl:function(e){return p.a.SERVER_URL+p.a.SERVER_NAME+e},getAttachmentUrl:function(e){return p.a.SERVER_URL+p.a.ATTACHMENT_SERVER_NAME+e},setCookie:function(e,t,a){var n=new Date;n.setTime(n.getTime()+864e5*a),window.document.cookie=e+"="+t+";path=/;expires="+n.toGMTString()},getCookie:function(e){var t=window.document.cookie.match("(^|;) ?"+e+"=([^;]*)(;|$)");return t?t[2]:null},deleteCookie:function(e){this.setCookie(e,"",-1)},convertObjToDateStr:function(e){var t=null;return e.date&&e.time&&(t=e.date+" "+e.time+":00"),t},convertDateStrToObj:function(e){var t={date:"",time:""};if(e){var a=e.split(" ");a.length>=2&&(t.date=a[0],t.time=a[1])}return t},padLeftZero:function(e){return("00"+e).substr(e.length)},parseServerUrl:function(e){var t=/^http:\/\/(.*?)\/$/;return e.match(t)[1]},setNetWork:function(e){p.a.SERVER_URL="http://"+e+"/"},convertUuidToName:function(e,t){var a="";return e instanceof Array&&e.forEach(function(e){if(e.uuid===t)return a=e.name,!1}),a},getItemByUuid:function(e,t){var a=null;return e instanceof Array&&e.forEach(function(e){if(e.uuid===t)return a=e,!1}),a},getDicByClassification:function(e){var t=[];return h.a.getters.appDictionary instanceof Array&&h.a.getters.appDictionary.forEach(function(a){a.classification===e&&t.push(a)}),t},parseTimeStamp:function(e){return this.pad(parseInt(e/36e5),2)+":"+this.pad(parseInt(e%36e5/6e4),2)},pad:function(e,t){for(var a=e.toString().length;a<t;)e="0"+e,a++;return e},pushRepeatArrayByUuid:function(e,t){var a=this;e instanceof Array&&t instanceof Array&&t.forEach(function(t){-1===a.findItemByUuid(e,t.uuid)&&e.push(t)})},findItemByUuid:function(e,t){for(var a=-1,n=0;n<e.length;++n)if(e[n].uuid===t){a=n;break}return a},getItemsByParentUuid:function(e,t){for(var a=[],n=0;n<e.length;++n)e[n].parentUuid===t&&a.push(e[n]);return a},setTitle:function(e){e=e?e+" - "+p.a.APP_NAME:p.a.APP_NAME,window.document.title=e}}},,,,function(e,t,a){"use strict";function n(e){var t=new Konva.Group({name:"shapeWrap",_shapeCfg:e,draggable:!1,shapeUuid:p()()}),a=new Konva.Group({name:"shapeGroup",draggable:!1}),n=new Konva.Group({name:"interactiveGroup",draggable:!1});return t.add(a,n),t}function i(e){var t=e.find(".shapeGroup"),a=null;return t.forEach(function(e){if(!1===e.getAttr("_isDrawn"))return a=e,!1}),a}function o(e){e.off("evt-draw"),e.off("evt-stop"),r(e)}function r(e){var t=i(e);t&&t.setAttr("_isDrawn",!0),s(e),c(e)}function s(e){e.find("Transformer").destroy(),e.find(".shapeAnchor").hide(),e.find(".shapeSubline").hide(),e.find(".shapeWrap").forEach(function(e){e.getAttr("actived")&&e.setAttr("actived",!1)}),e.find(".shapeGroup").forEach(function(e){e.getDraggable()&&e.setDraggable(!1)})}function l(e,t){var a=e.getLayer();e.find(".shapeAnchor")[t](),e.find(".shapeSubline")[t](),e.find("Transformer")[t](),a.draw()}function c(e){e.children.forEach(function(e){e.draw()})}function u(e){if(e){var t=e.getStage(),a=e.getLayer(),n=e.findAncestor(".shapeWrap"),i=n.findOne(".shapeGroup"),o="."+a.getAttr("name");window.plotstack.execute(new window.DeleteCommand(t,o,i)),n?(n.destroy(),a.draw()):e.destroy(),t.fire("evt_update_elements",{type:"delete",element:n}),t.fire("evt_update_legend")}}function d(e){if(e){var t=e.getLayer(),a=e.findAncestor(".shapeWrap"),n=a.clone();t.add(n),n.move({x:20,y:20}),t.draw();var i=e.getStage();i.fire("evt_update_legend");var o="."+t.getAttr("name"),r=n.findOne(".shapeGroup");window.plotstack.execute(new window.InsertCommand(i,o,r))}}t.d=n,t.h=i,t.c=o,t.e=s,t.f=l,t.g=c,t.b=u,t.a=d;var h=a(25),p=a.n(h)},,,,,,function(e,t,a){"use strict";var n=a(2),i=a.n(n),o=a(4),r=a(26),s=a(62),l=a.n(s),c=a(66),u=a(63),d=a(65);o.default.use(r.a);var h={ploterCfg:null,stageData:null,stageSize:{width:800,height:600},stageElements:null};t.a=new r.a.Store({state:h,mutations:c.a,actions:l.a,getters:u.a,modules:i()({},d.a)})},,,,,,,,,,function(e,t,a){"use strict";function n(e){var t=f()({},y.a),a=t.children,n=a.find(function(e){return"backgroundLayer"===e.attrs.name}),i=a.find(function(e){return"shapesLayer"===e.attrs.name}),o=u("stage"),r=o.width,s=o.height,l=o.fill;return e&&(r=e.width,s=e.height,i.children.push({attrs:{name:"shapeWrap",_shapeCfg:{name:"底图",id:"backgroundImg",type:"image",style:{importSize:"image",mainShape:{src:e.backgroundImage}}},activable:!0},className:"Group",children:[{attrs:{name:"shapeGroup",draggable:!0,x:0,y:0},className:"Group",children:[{attrs:{id:"stageBackgroundImg",name:"mainShape",x:0,y:0,width:r,height:s},className:"Image"}]},{attrs:{name:"interactiveGroup"},className:"Group",children:[]}]})),n.children.push({attrs:{name:"shapeWrap",_shapeCfg:{name:"画布区域",id:"backgroundArea",type:"Rect",style:{}},activable:!1},className:"Group",children:[{attrs:{name:"shapeGroup",draggable:!1,_isDrawn:!0,x:0,y:0},className:"Group",children:[{attrs:{id:"stageBackgroundArea",name:"backgroundAreaShape",x:0,y:0,width:r,height:s,fill:l},className:"Rect"}]}]}),t.attrs.width=r,t.attrs.height=s,t}function i(e,t){switch(e.type){case"icon":g.a.init(e,t);break;case"area":"rectangle"===e.style.shapeType&&m.a.init(e,t);break;case"image":v.a.init(e,t)}}function o(e){var t=e.findOne(".shapesLayer"),a=t.children;a.forEach(function(e){"image"===e.getAttr("_shapeCfg").type&&v.a.reloadShape(e)}),setTimeout(function(){a.forEach(function(e){var t=e.getAttr("_shapeCfg");switch(t.type){case"icon":g.a.reloadShape(e);break;case"area":"rectangle"===t.style.shapeType&&m.a.reloadShape(e)}})},0)}function r(e,t,a){e.setAttrs({width:t,height:a})}function s(e,t,n){if(!a.i(w.c)(e)&&!a.i(w.c)(t)&&!a.i(w.c)(n)){var i=t.findAncestor(".shapeWrap"),o=i.getAttr("_shapeCfg");switch(o.type){case"icon":g.a.applyFeature(e,t,n);break;case"area":"rectangle"===o.style.shapeType&&m.a.applyFeature(e,t,n);break;case"image":v.a.applyFeature(e,t,n)}}}function l(e,t){var a=e.findOne("#stageBackground");e.setAttrs({width:t.width,height:t.height}),a.setAttrs({width:t.width,height:t.height,fill:t.fill}),e.draw()}function c(){var e=localStorage.getItem("plotSetting");JSON.parse(e)||localStorage.setItem("plotSetting",h()({stage:{width:1200,height:800,fill:"#fff"},icon:{width:48,height:48}}))}function u(e){var t=localStorage.getItem("plotSetting"),a=JSON.parse(t);return e?a[e]:a}var d=a(18),h=a.n(d),p=a(2),f=a.n(p),g=a(67),m=a(69),v=a(68),S=a(150),y=a.n(S),w=a(7);t.a={initLocalSetting:c,reloadShapes:o,getLocalSetting:u,createEmptyStageData:n,initPlotTool:i,applyFeature:s,resizeCanvas:r,applyStageCfg:l}},,,,,,,,,,,,,,,,,function(e,t){e.exports={uuid:"",code:"",codeFontSize:10,codeFontStyle:"normal",codeFontFamily:"simsun",name:"",nameFontSize:14,nameFontStyle:"bold",nameFontFamily:"simsun",boothType:"",entryType:"",lateralLength:0,verticalLength:0,area:0,status:"normal",shapeUuid:"",stageUuid:"",tenantId:"",tenantName:""}},function(e,t,a){"use strict";function n(){i.default.use(r.a)}var i=a(4),o=a(129),r=a.n(o);t.a={init:n}},function(e,t,a){"use strict";function n(){i.default.use(r.a),r.a.LoadingBar.config({color:"#ffc800",failedColor:"#ff4949",height:2})}var i=a(4),o=a(43),r=a.n(o),s=a(113);a.n(s);t.a={init:n}},function(e,t,a){"use strict";var n=a(4),i=a(147),o=a(61),r=a(43),s=a.n(r),l=a(7);n.default.use(i.a);var c=new i.a({routes:o.a});c.beforeEach(function(e,t,a){s.a.LoadingBar.start(),l.a.setTitle(e.meta.title),a()}),c.afterEach(function(){s.a.LoadingBar.finish(),window.scrollTo(0,0)}),t.a=c},function(e,t,a){a(117);var n=a(0)(null,a(143),null,null);e.exports=n.exports},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(149),i=a.n(n),o=a(44),r=a.n(o);t.default={props:{show:{type:Boolean,default:!1},data:{type:Object}},data:function(){return{visible:this.show,formData:r.a,baseFontOptions:i.a,dataStatus:[{name:"新建展位",value:"normal"},{name:"已分配展位",value:"allotted"},{name:"已预定展位",value:"bespoke"},{name:"已确定展位",value:"completed"}]}},computed:{},watch:{show:function(e,t){this.visible=e},data:function(e,t){this.formData=e},"formData.lateralLength":"calcArea","formData.verticalLength":"calcArea"},methods:{handlerCancel:function(){this.formData=r.a,this.$emit("close")},saveData:function(){this.$store.dispatch("updateBusinessRecord",this.formData),this.$emit("close")},calcArea:function(){this.formData.area=this.formData.lateralLength*this.formData.verticalLength.toFixed(2)}}}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(2),i=a.n(n),o=a(26),r=a(25),s=a.n(r),l=a(125),c=a.n(l),u=a(7),d=a(130),h=a.n(d),p=a(44),f=a.n(p),g=a(58);t.default={name:"ComponentsBusinessShape",components:{AttributeModule:h.a},data:function(){return{attributeModule:{show:!1,data:null}}},computed:i()({},a.i(o.b)({wrapStageData:"wrapStageData",ploterConfig:"ploterConfig",stageElements:"stageElements",componentsBusinessShapeData:"componentsBusinessShapeData"})),watch:{ploterConfig:function(e){var t=this;e.businessShape&&e.businessShape.enable&&(window.wrapHandshake.model.updateBusinessData=this.updateBusinessData,window.wrapHandshake.model.updateBusinessRecord=this.updateBusinessRecord,window.ploterStage.on("evt_stage_element_dblclick",this.onStageElementDblclick),window.ploterStage.on("evt_stage_element_changed",this.onStageElementChanged),window.ploterStage.on("evt_stage_element_contextmenu",this.onStageElementContextmenu),window.ploterStage.on("evt_stage_element_mouseenter",this.onStageElementMouseenter),window.ploterStage.on("evt_stage_element_mouseleave",this.onStageElementMouseleave),setTimeout(function(){t.getBusinessData(t.wrapStageData.uuid)},1e3))},componentsBusinessShapeData:{handler:function(e){this.updateStageFromBusinessData(e)},deep:!0}},mounted:function(){},methods:{onStageElementDblclick:function(e){var t=e.getAttr("shapeUuid"),n=this.componentsBusinessShapeData.find(function(e){return e.shapeUuid===t});n&&(this.ploterConfig.readOnly?window.wrapHandshake.emit("evtBusinessShapeSelected",n):(this.attributeModule.data=a.i(u.b)(n),this.attributeModule.show=!0))},onStageElementChanged:function(e){var t=e.element.getAttr("shapeUuid");if(e.element.getAttr("_shapeCfg").businessShape)if("add"===e.changeType){var a=i()({},f.a,{uuid:s()(),shapeUuid:t,stageUuid:this.wrapStageData.uuid});this.$store.dispatch("addBusinessRecord",a)}else if("delete"===e.changeType){var n=this.$store.getters.componentsBusinessRecordGet(t);this.$store.dispatch("removeBusinessRecord",n)}},getBusinessData:function(){window.wrapHandshake.emit("evtNeedBusinessData");var e=this.ploterConfig.businessShape.requestLoop;e>0&&setTimeout(function(){me.getBusinessData()},e)},updateBusinessData:function(e){this.$store.commit("updateBusinessShapeData",e)},updateBusinessRecord:function(e){this.$store.dispatch("updateBusinessRecord",e)},updateStageFromBusinessData:function(e){var t=this;e.forEach(function(e){var n="";n=a.i(u.c)(e.tenantName)||"normal"===e.status?e.name:e.tenantName;var i={textShape:{fields:[{alias:"code",value:e.code,fontSize:e.codeFontSize,fontStyle:e.codeFontStyle,fontFamily:e.codeFontFamily},{alias:"name",value:n,fontSize:e.nameFontSize,fontStyle:e.nameFontStyle,fontFamily:e.namefontFamily}]},mainShape:{}};"normal"===e.status?(i.mainShape.stroke="#666",i.mainShape.fill="#eaeaea",i.textShape.fill="#666"):"allotted"===e.status?(i.mainShape.stroke="#f00000",i.mainShape.fill="#ffdddd",i.textShape.fill="#f00000"):"bespoke"===e.status?(i.mainShape.stroke="#827700",i.mainShape.fill="#ffea00",i.textShape.fill="#827700"):"completed"===e.status&&(i.mainShape.stroke="#199200",i.mainShape.fill="#baffac",i.textShape.fill="#199200");var o=e.shapeUuid;t.$emit("evt_stage_element_feature_changed",o,i)})},handlerModelCancel:function(){this.attributeModule.data=f.a,this.attributeModule.show=!1},onStageElementContextmenu:function(e){var t=this;if(!this.ploterConfig.readOnly){var a=t.getBusinessShapeContextmenu();a.onclick=function(n){switch(n.preventDefault(),n.stopPropagation(),n.target.dataset.action){case"detail":t.onStageElementDblclick(e.element);break;case"allot":t.doAllotBusinessData(e.element);break;case"delete":var i=e.element.findOne(".mainShape");t.$emit("evt_stage_element_remove",i)}a.hide()},a.style.top=e.event.offsetY+"px",a.style.left=e.event.offsetX+"px",a.show()}},onStageElementMouseenter:function(e){var t=e.element.getAttr("shapeUuid"),a=this.componentsBusinessShapeData.find(function(e){return e.shapeUuid===t});if(a){var n=this.getBusinessShapeTip(!0),i=c()(g.a,{code:a.code||"",name:a.name||"",area:a.area||"",boothType:a.boothType||"",entryType:a.entryType||""});n.innerHTML=i,n.style.top=e.event.offsetY+"px",n.style.left=e.event.offsetX+"px",n.show()}},onStageElementMouseleave:function(e){var t=this.getBusinessShapeTip(!1);t&&t.hide()},doAllotBusinessData:function(e){var t=e.getAttr("shapeUuid"),a=this.componentsBusinessShapeData.find(function(e){return e.shapeUuid===t});a&&(this.ploterConfig.readOnly||window.wrapHandshake.emit("evtBusinessDataAllot",a))},getBusinessShapeContextmenu:function(e){var t=document.querySelector(".app-ploter-main-canvas"),a=t.querySelector(".konvajs-content");if(a){var n=a.querySelector(".business-shape-contextmenu");if(!n){n=document.createElement("ul");n.className="business-shape-contextmenu",n.innerHTML='<li data-action="detail">查看详情</li><li data-action="allot">指定展位</li><li data-action="delete">删除</li>',a.appendChild(n)}return n.show=function(){n.style.display="block",document.body.addEventListener("click",this.hide)},n.hide=function(){n.style.top=0,n.style.left=0,n.style.display="none",document.body.removeEventListener("click",this.hide)},n}},getBusinessShapeTip:function(e){var t=document.querySelector(".app-ploter-main-canvas"),a=t.querySelector(".konvajs-content");if(a){var n=a.querySelector(".business-shape-tip");return!n&&e&&(n=document.createElement("div"),n.className="business-shape-tip",a.appendChild(n)),n&&(n.show=function(){n.style.display="block"},n.hide=function(){n.style.top=0,n.style.left=0,n.style.display="none"}),n}}}}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"AppPloterBBarCoordinate",props:["coordinate"],data:function(){return{x:0,y:0}},computed:{viewCoordinate:function(){return{x:Math.round(this.coordinate.x),y:Math.round(this.coordinate.y)}}}}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"AppPloterBBarMessage",props:["plotTool"],computed:{isLine:function(){return"line"===this.plotTool.type||"arrowLine"===this.plotTool.type},plotToolDesc:function(){var e=this.plotTool.desc;return e||(e="此工具没有描述信息"),e}}}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(148),i=a.n(n);t.default={name:"AppPloterBBarStageAttr",props:["stage"],data:function(){return{stageCfg:{width:800,height:600,fill:"#fff"},baseColors:i.a,scaleLevel:1}},watch:{stage:function(e){if(e){var t=e.findOne("#stageBackgroundArea");this.stageCfg={width:e.getWidth(),height:e.getHeight(),fill:t.getFill()},console.log(this.stageCfg)}}},mounted:function(){this.stage.on("evt_stage_scale_changed",this.onStageScaleChanged)},methods:{onApplyCfg:function(){this.$emit("evtStageCfgChanged",this.stageCfg)},onScaleChange:function(e){this.$emit("evtStageScaleChanged",e)},onResetScale:function(){this.scaleLevel=1,this.$emit("evtStageScaleReset")},onStageScaleChanged:function(e){this.scaleLevel=e.scaleLevel},tipFormat:function(e){return 100*e+"%"}}}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(18),i=a.n(n),o=a(2),r=a.n(o),s=a(26),l=a(27),c=a(60),u=a(11),d=a(70),h=a(121),p=(a.n(h),a(7)),f=a(131),g=a.n(f),m=a(133),v=a.n(m),S=a(132),y=a.n(S),w=a(134),_=a.n(w),b=a(137),x=a.n(b),A=a(136),C=a.n(A);t.default={name:"AppPloterMain",components:{ComponentsBusinessShape:g.a,AppPloterBBarMessage:v.a,AppPloterBBarCoordinate:y.a,AppPloterBBarStageAttr:_.a,AppPloterWidgetScale:x.a,AppPloterWidgetMove:C.a},data:function(){return{stage:null,currentPlotTool:null,currentPlotActiveItem:null,currentPasteItem:null,footer:{show:!1},coordinateSystem:{system:"像素",x:0,y:0}}},computed:r()({},a.i(s.b)({wrapStageData:"wrapStageData",ploterConfig:"ploterConfig",stageElements:"stageElements",stageSize:"stageSize",componentsBusinessShapeData:"componentsBusinessShapeData"})),watch:{},created:function(){l.a.initLocalSetting()},mounted:function(){var e=this;new Postmate.Model({saveHandler:e.emitSaveData,selectToolHandler:e.onToolSelected}).then(function(t){window.wrapHandshake=t;var a=t.model.stageRecord;e.$store.commit("updateStageData",a);var n=t.model.config;n&&e.$store.commit("updatePloterCongig",n),e.initPloter(a.jsonData||null)}),c.a.init()},methods:{initPloter:function(e){var t=this;if(e)t.initStage(e,".app-ploter-main-canvas");else{if(t.stage){!0===confirm("现在执行新建操作将放弃对当前画布做出的修改，\n点击确认按钮前请确认您的标绘成果已经保存。")&&t.stage.destroy()}var a=t.ploterConfig.createCfg;a?"img"===a.type&&(e=i()(l.a.createEmptyStageData({width:a.width,height:a.height,backgroundImage:a.from})),t.initStage(e,".app-ploter-main-canvas")):(e=i()(l.a.createEmptyStageData()),t.initStage(e,".app-ploter-main-canvas"))}this.ploterConfig.readOnly||(t.footer.show=!0)},initStage:function(e,t){var n=this;window.ploterStage&&window.ploterStage.destroy();var i=a.i(d.a)(e),o=Konva.Node.create(i,t);window.ploterStage=o,n.stage=o,l.a.reloadShapes(o),n.$store.commit("updateStageSize",{width:o.getWidth(),height:o.getHeight()}),n.setStageLayout(),n.initStageEvent(o)},initStageEvent:function(e){var t=this;if(!this.ploterConfig.readOnly){e.on("mousedown",function(a){var n=a.evt.button,i=a.target,o=i.getAttr("name");0===n?"shapeAnchor"!==o&&"Transformer"!==i.parent.className&&(t.currentPlotTool?e.fire("evt-draw",a):"Stage"!==i.nodeType&&("stageBackgroundArea"===i.getId()&&"stageBackgroundImg"===i.getId()||t.doSelectShape(i))):t.doExitPlotTool()}),e.on("evt_stage_element_changed",function(e){var t=e.target.toJSON();a.i(d.b)(JSON.parse(t)),window.focus()});var n=t.$refs.plotStage.querySelector(".konvajs-content");n.addEventListener("mousemove",function(a){var n=e.getPointerPosition();t.coordinateSystem.x=n.x,t.coordinateSystem.y=n.y}),n.addEventListener("mouseout",function(e){t.coordinateSystem.x=null,t.coordinateSystem.y=null}),window.addEventListener("keydown",function(n){console.log("event",n),46===n.keyCode?t.currentPlotActiveItem&&t.doShapeDelete(t.currentPlotActiveItem):27===n.keyCode?(e.fire("evt-stop"),t.currentPlotActiveItem=null):67===n.keyCode&&n.ctrlKey?t.currentPlotActiveItem&&"MoftArrowLine"===t.currentPlotActiveItem.className?alert("当前元素不支持复制粘贴操作"):t.currentPasteItem=t.currentPlotActiveItem:86===n.keyCode&&n.ctrlKey?t.currentPasteItem&&a.i(u.a)(t.currentPasteItem):90===n.keyCode&&n.ctrlKey?window.plotstack.canUndo()?window.plotstack.undo():alert("无可撤销内容"):89===n.keyCode&&n.ctrlKey&&(window.plotstack.canRedo()?window.plotstack.redo():alert("无可恢复内容"))})}t.$refs.plotStage.oncontextmenu=function(){return!1},window.addEventListener("resize",function(e){t.setStageLayout()}),window.focus()},onSelectFile:function(){this.$refs.loadInput.click()},onSelectedPlotFile:function(e){var t=this,a=this,n=e.target.files[0];if("function"==typeof FileReader){var i=new FileReader;i.onload=function(e){var n=e.target.result.replace("data:;base64,",""),i=JSON.parse(h.Base64.decode(n));if(!i.attrs.mplot)return void alert("文件无效，请选择.mplot后缀的云帆标绘文件");if(a.stage){!0===confirm("现在打开标绘文件将放弃对当前画布做出的修改，\n点击确认按钮前请确认您的标绘成果已经保存。")&&a.initPloter(i)}t.$refs.loadInput.value=""},i.readAsDataURL(n)}else alert("您的浏览器版本太低，请升级。")},onToolSelected:function(e){this.stage&&(this.stage.fire("evt-stop"),this.currentPlotTool=e,this.initPlotTool())},onFeatureChange:function(e,t){var n=a.i(d.c)(e),i=n.findOne(".mainShape");l.a.applyFeature(this.stage,i,t)},onStageCfgChanged:function(e){l.a.applyStageCfg(this.stage,e)},onStageScaleChanged:function(e){this.doStageScale(e)},onStageScaleReset:function(){this.doStageScaleReset()},onSelectShape:function(e){var t=this,n=a.i(d.c)(e);n&&t.doSelectShape(n.findOne(".mainShape"))},initPlotTool:function(){if(this.currentPlotTool){var e=r()({},a.i(p.b)(this.currentPlotTool)),t=this.stage;l.a.initPlotTool(e,t)}},doShapeDelete:function(e){var t=this.stage,n=e.findAncestor(".shapeWrap");a.i(u.b)(e),t.fire("evt_stage_element_changed",{changeType:"delete",element:n}),this.currentPlotActiveItem=null},doExitPlotTool:function(){var e=this,t=e.stage;t.fire("evt-stop"),a.i(u.c)(t),e.currentPlotTool=null,e.currentPlotActiveItem=null},doSelectShape:function(e){var t=this;e.fire("evt-active",e),t.currentPlotActiveItem=e},doStageScale:function(e){var t=this.stage,a=document.querySelector(".konvajs-content"),n={width:Math.round(this.stageSize.width*e),height:Math.round(this.stageSize.height*e)};a.style.width=n.width+"px",a.style.height=n.height+"px",t.setAttrs({width:n.width,height:n.height}),t.scale({x:e,y:e}),t.draw(),t.fire("evt_stage_scale_changed",{scaleLevel:e}),this.setStageLayout()},doStageScaleReset:function(){var e=this.stage,t=document.querySelector(".konvajs-content");t.style.width=this.stageSize.width+"px",t.style.height=this.stageSize.height+"px",e.setAttrs({width:this.stageSize.width,height:this.stageSize.height}),e.scale({x:1,y:1}),e.draw(),e.fire("evt_stage_scale_changed",{scaleLevel:1}),this.setStageLayout()},setStageLayout:function(){var e=this,t=this.$refs.plotStage,a=this.stage,n=window.innerWidth;e.currentPlotActiveItem&&(n=window.innerWidth-320),n>a.width()?t.setAttribute("data-layout-center",!0):t.removeAttribute("data-layout-center")},emitSaveData:function(){var e=this,t=this;this.stage.fire("evt-stop"),a.i(u.c)(this.stage),this.currentPlotTool=null,this.currentPlotActiveItem=null,this.doStageScaleReset(),setTimeout(function(){var a=t.stage.toJSON(),n=t.stage.toDataURL(),i={stageUuid:e.wrapStageData.uuid,jsonData:a,picData:n,businessData:e.componentsBusinessShapeData};window.wrapHandshake.emit("evtSaveDataReady",i)},1e3)}}}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"AppPloterWidgetMove",data:function(){return{step:100}},methods:{onMoveTo:function(e){var t=document.querySelector(".app-ploter-main-canvas"),a=t.scrollLeft,n=t.scrollTop;switch(e){case"up":t.scrollTo(a,n-this.step);break;case"right":t.scrollTo(a+this.step,n);break;case"down":t.scrollTo(a,n+this.step);break;case"left":t.scrollTo(a-this.step,n)}}}}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"AppPloterWidgetScale",props:["stage"],data:function(){return{scaleLevel:1}},watch:{},mounted:function(){this.stage.on("evt_stage_scale_changed",this.onStageScaleChanged)},methods:{onScaleEnlarge:function(){var e=this.scaleLevel+.1;this.$emit("evtStageScaleChanged",e)},onScaleNarrow:function(){var e=this.scaleLevel-.1;this.$emit("evtStageScaleChanged",e)},onResetScale:function(){this.scaleLevel=1,this.$emit("evtStageScaleReset")},onStageScaleChanged:function(e){this.scaleLevel=e.scaleLevel}}}},function(e,t,a){"use strict";t.a={APP_NAME:"二维标绘编辑器 - 数字化灭火救援预案平台",SERVER_DOMAIN_DEV:"",SERVER_DOMAIN:"",SERVER_DOMAIN_DEBUG:"",SERVER_PATH:"",AJAX_TIMEOUT:3e4}},function(e,t,a){"use strict";a.d(t,"a",function(){return n});var n='<table class="tip-content-table" cellpadding="0" cellspacing="0"><tr><th>展位编号:</th><td>{code}</td></tr><tr><th>展位名称:</th><td>{name}</td></tr><tr><th>展位面积:</th><td>{area}</td></tr><tr><th>展位类型:</th><td>{boothType}</td></tr><tr><th>出口类型:</th><td>{entryType}</td></tr></table>'},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(4),i=a(47),o=a(48),r=a.n(o),s=a(17),l=a(45),c=a(46);l.a.init(),c.a.init(),new n.default({el:"#app",router:i.a,store:s.a,render:function(e){return e(r.a)}}),console.info("[当前环境] 生产环境"),n.default.config.devtools=!1},function(e,t,a){"use strict";function n(){window.plotstack=new Undo.Stack,window.InsertCommand=Undo.Command.extend({constructor:function(e,t,a){this.stage=e,this.layer=t,this.shapeGroup=a,this.shapeWrapOld=a.findAncestor(".shapeWrap"),this.targetLayer=e.findOne(this.layer),this.shapeWrap=null},execute:function(){},undo:function(){this.shapeWrap=this.shapeWrapOld.clone();var e=[];this.shapeWrapOld.children.forEach(function(t){t.children.forEach(function(t){e.push(t)}),e.push(t)});for(var t=0;t<e.length;t++)e[t].destroy();this.shapeWrapOld.destroy(),this.targetLayer.draw(),".legendLayer"!==this.layer&&this.stage.fire("evt_update_legend")},redo:function(){this.shapeWrap&&(this.targetLayer.add(this.shapeWrap),this.targetLayer.draw(),".legendLayer"!==this.layer&&this.stage.fire("evt_update_legend"),this.shapeWrapOld=this.shapeWrap)}}),window.EditCommand=Undo.Command.extend({constructor:function(e,t){this.stage=e,this.layer=t,this.shapeGroupOld=null,this.shapeGroupNew=null,this.shapeGroup=null},setOldValue:function(e){this.shapeGroupOld=e.clone()},setNewValue:function(e){this.shapeGroup=e},execute:function(){},undo:function(){if(this.shapeGroup&&this.shapeGroupOld){this.shapeGroupNew=this.shapeGroup.clone();for(var e=0;e<this.shapeGroup.children.length;e++){var t=this.shapeGroup.children[e],a=this.shapeGroupOld.children[e];t.setAttrs(a.getAttrs())}this.shapeGroup.setAttrs(this.shapeGroupOld.getAttrs());this.stage.findOne(this.layer).draw()}},redo:function(){if(this.shapeGroup&&this.shapeGroupNew){for(var e=0;e<this.shapeGroup.children.length;e++){var t=this.shapeGroup.children[e],a=this.shapeGroupNew.children[e];t.setAttrs(a.getAttrs())}this.shapeGroup.setAttrs(this.shapeGroupNew.getAttrs());this.stage.findOne(this.layer).draw()}}}),window.DeleteCommand=Undo.Command.extend({constructor:function(e,t,a){this.stage=e,this.layer=t,this.shapeGroup=a,this.shapeWrapOld=a.findAncestor(".shapeWrap"),this.targetLayer=e.findOne(this.layer),this.shapeWrap=null},execute:function(){this.shapeWrap=this.shapeWrapOld.clone()},undo:function(){this.shapeWrap&&(this.targetLayer.add(this.shapeWrap),this.targetLayer.draw(),this.stage.fire("evt_update_legend"),this.shapeWrapOld=this.shapeWrap)},redo:function(){this.shapeWrap=this.shapeWrapOld.clone();var e=[];this.shapeWrapOld.children.forEach(function(t){t.children.forEach(function(t){e.push(t)}),e.push(t)});for(var t=0;t<e.length;t++)e[t].destroy();this.shapeWrapOld.destroy(),this.targetLayer.draw(),this.stage.fire("evt_update_legend")}})}t.a={init:n}},function(e,t,a){"use strict";t.a=[{path:"/",component:a(135),props:!0,meta:{requireAuth:!0}},{path:"*",component:{beforeCreate:function(){console.log("Warn: 404"),this.$router.replace("/")},template:"<div></div>"}}]},function(e,t){},function(e,t,a){"use strict";t.a={ploterConfig:function(e){return e.ploterCfg},wrapStageData:function(e){return e.stageData},stageSize:function(e){return e.stageSize},stageElements:function(e){return e.stageElements}}},function(e,t,a){"use strict";t.a={state:{attribute:{show:!1,editable:!1},businessShapeData:null},actions:{addBusinessRecord:function(e,t){var a=e.getters,n=e.commit,i=a.componentsBusinessShapeData;t&&(i.push(t),n("updateBusinessShapeData",i))},updateBusinessRecord:function(e,t){var a=e.getters,n=e.commit,i=a.componentsBusinessShapeData,o=i.find(function(e){return e.uuid===t.uuid});if(o){for(var r in t)if(t.hasOwnProperty(r)){var s=t[r];o[r]=s}n("updateBusinessShapeData",i)}},removeBusinessRecord:function(e,t){var a=e.getters,n=e.commit,i=a.componentsBusinessShapeData;if(t){var o=i.findIndex(function(e){return e.uuid===t.uuid});o>=0&&(i.splice(o,1),n("updateBusinessShapeData",i))}}},mutations:{updateBusinessShapeData:function(e,t){e.businessShapeData=t}},getters:{componentsBusinessRecordGet:function(e){return function(t){return e.businessShapeData.find(function(e){return e.shapeUuid===t})}},componentsBusinessShapeData:function(e){return e.businessShapeData}}}},function(e,t,a){"use strict";var n=a(64);t.a={businessShape:n.a}},function(e,t,a){"use strict";var n,i=a(75),o=a.n(i);t.a=(n={},o()(n,"updatePloterCongig",function(e,t){e.ploterCfg=t}),o()(n,"updateStageData",function(e,t){e.stageData=t}),o()(n,"updateStageSize",function(e,t){e.stageSize=t}),o()(n,"updateStageElements",function(e,t){e.stageElements=t}),n)},function(e,t,a){"use strict";function n(e,t){a.i(p.c)(t),t.on("evt-draw",function(a){var n=t.getPointerPosition();i(e,n,t),t.fire("evt_update_legend")})}function i(e,t,n){var i=n.findOne(".shapesLayer"),o=new Image,s=e.src+".png";o.src=s,o.onload=function(){var s=h.a.getLocalSetting(),l={width:e.style.mainShape.width||s.icon.width||48,height:e.style.mainShape.height||s.icon.height||48},c=n.scale(),u=t.x/c.x-l.width/2,f=t.y/c.y-l.height/2,g=a.i(p.d)(e);g.setAttr("activable",!0);var m=g.findOne(".shapeGroup");i.add(g);var v=new Konva.Image({name:"mainShape",x:u,y:f,width:l.width,height:l.height,image:o,draggable:!1});if(v.on("evt-active",r),m.add(v),e.style.textShape){var S=1.5*l.width,y=l.height/3,w=u-(S-l.width)/2,_=f-2-y;"battle_direction_flfx"===e.id&&(_+=l.height/2);var b=new Konva.Text(d()({name:"textShape",x:w,y:_,width:S,height:y,align:"center",wrap:"none",ellipsis:!0,draggable:!1},e.style.textShape));m.add(b)}i.draw(),n.fire("evt_stage_element_changed",{changeType:"add",element:g}),window.plotstack.execute(new window.InsertCommand(n,".shapesLayer",m))}}function o(e,t,a){var n=t.findAncestor(".shapeWrap"),i=n.findOne(".shapeGroup"),o=i.findOne(".mainShape"),r=i.findOne(".textShape"),s=new window.EditCommand(e,".shapesLayer");if(s.setOldValue(i),i.opacity(a.opacity),o){if(o.getWidth()!==a.mainShape.width){var l=o.getPosition().x-(a.mainShape.width-o.getWidth())/2;a.mainShape.x=Math.round(l)}if(o.getHeight()!==a.mainShape.height){var c=o.getPosition().y-(a.mainShape.height-o.getHeight())/2;a.mainShape.y=Math.round(c)}o.setAttrs({x:a.mainShape.x,y:a.mainShape.y,width:a.mainShape.width,height:a.mainShape.height})}if(r){if(r.getWidth()!==a.textShape.width){var u=r.getPosition().x-(a.textShape.width-r.getWidth())/2;a.textShape.x=Math.round(u)}if(r.getHeight()!==a.textShape.height){var d=r.getPosition().y-(a.textShape.height-r.getHeight())/2;a.textShape.y=Math.round(d)}r.setAttrs({x:a.textShape.x,y:a.textShape.y,width:a.textShape.width,height:a.textShape.height,align:a.textShape.align,text:a.textShape.text,fill:a.textShape.fill,fontFamily:a.textShape.fontFamily,fontSize:a.textShape.fontSize})}e.findOne(".shapesLayer").draw(),s.setNewValue(i),window.plotstack.execute(s)}function r(e){var t=e.getStage(),n=e.findAncestor(".shapeWrap"),i=e.findAncestor(".shapeGroup"),o=n.findOne(".interactiveGroup"),r=o.findOne(".transformer");if(n.getAttr("activable")&&!r){a.i(p.e)(t);var s=new Konva.Transformer({name:"transformer",rotateHandlerOffset:20,enabledHandlers:["top-left","top-right","bottom-left","bottom-right"]});s.on("dragend",function(e){var t=this.findAncestor(".shapeWrap"),a=t.findOne(".shapeGroup"),n=t.findOne(".mainShape"),i=a.getAttr("scaleX")||1,o=a.getAttr("scaleY")||1,r=n.getAttr("width"),s=n.getAttr("height"),l={width:r*i,height:s*o},u=h.a.getLocalSetting();u.icon=l,localStorage.setItem("plotSetting",c()(u))}),s.attachTo(i),o.add(s),i.setDraggable(!0),n.setAttr("actived",!0),a.i(p.f)(n,"show"),a.i(p.g)(t)}}function s(e){var t=e.getAttr("_shapeCfg"),a=e.findOne(".shapeGroup"),n=a.findOne(".mainShape"),i=new Image;e.setAttr("actived",!1),i.onload=function(){n.image(i),n.on("evt-active",r),n.draw()},i.src=t.src+".png"}var l=a(18),c=a.n(l),u=a(2),d=a.n(u),h=a(27),p=a(11);t.a={init:n,applyFeature:o,reloadShape:s}},function(e,t,a){"use strict";function n(e,t){a.i(h.c)(t),i(e,t)}function i(e,t){var n=t.findOne(".shapesLayer"),i=new Image;i.onload=function(){var o=a.i(h.d)(e);o.setAttr("activable",!0);var s=o.findOne(".shapeGroup");n.add(o);var u=l(i,e.style.importSize,t),p=c(u,t),f=new Konva.Image(d()({name:"mainShape",image:i},p,u,{draggable:!1}));f.on("evt-active",r),s.add(f),n.draw(),window.plotstack.execute(new window.InsertCommand(t,".shapesLayer",s))},i.src=e.style.mainShape.src}function o(e,t,a){var n=t.findAncestor(".shapeWrap"),i=n.findOne(".shapeGroup"),o=i.findOne(".mainShape"),r=new window.EditCommand(e,".shapesLayer");r.setOldValue(i),i.opacity(a.opacity),o&&o.setAttrs(a.mainShape),e.findOne(".shapesLayer").draw(),r.setNewValue(i),window.plotstack.execute(r)}function r(e){var t=e.getStage(),n=e.findAncestor(".shapeWrap"),i=e.findAncestor(".shapeGroup"),o=n.findOne(".interactiveGroup");if(n.getAttr("activable")&&!n.getAttr("actived")){a.i(h.e)(t);var r=new Konva.Transformer({rotateHandlerOffset:20,enabledHandlers:["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"]});r.attachTo(i),o.add(r),i.setDraggable(!0),n.setAttr("actived",!0),a.i(h.f)(n,"show"),a.i(h.g)(t)}}function s(e){var t=e.getAttr("_shapeCfg"),a=e.findOne(".shapeGroup"),n=a.findOne(".mainShape");n.on("evt-active",r);var i=new Image;i.onload=function(){n.image(i),n.on("evt-active",r),n.draw()},i.src=t.style.mainShape.src}function l(e,t,a){var n=e.width,i=e.height,o=a.getWidth(),r=a.getHeight(),s={width:n,height:i};return"auto"===t?n>i?n>.9*o&&(s.width=Math.round(.9*o),s.height=Math.round(i*(s.width/n))):n<i?i>.9*r&&(s.height=Math.round(.9*r),s.width=Math.round(n*(s.height/i))):n>.9*o&&(o>r?(s.width=Math.round(.9*r),s.height=Math.round(.9*r)):o<r?(s.width=Math.round(.9*o),s.height=Math.round(.9*o)):(s.width=Math.round(.9*o),s.height=Math.round(.9*r))):"canvas"===t&&(n>i?(s.width=Math.round(.9*o),s.height=Math.round(i*(s.width/n))):n<i?(s.height=Math.round(.9*r),s.width=Math.round(n*(s.height/i))):o>r?(s.width=Math.round(.9*r),s.height=Math.round(.9*r)):o<r?(s.width=Math.round(.9*o),s.height=Math.round(.9*o)):(s.width=Math.round(.9*o),s.height=Math.round(.9*r))),s}function c(e,t){var a=e.width,n=e.height,i=t.getWidth(),o=t.getHeight();return{x:Math.round((i-a)/2),y:Math.round((o-n)/2)}}var u=a(2),d=a.n(u),h=a(11);t.a={init:n,applyFeature:o,reloadShape:s}},function(e,t,a){"use strict";function n(e,t){a.i(p.c)(t),t.on("evt-draw",function(a){var n=t.getPointerPosition();i(t,n,e),t.on("mousemove",function(a){var n=t.getPointerPosition();i(t,n,e)}),t.on("mouseup",function(a){t.off("mousemove");var n=t.getPointerPosition();i(t,n,e,!0),t.off("mouseup"),t.fire("evt_update_legend")})})}function i(e,t,n,i){var r=e.findOne(".shapesLayer"),l=a.i(p.h)(e),c=null;a.i(h.c)(l)?(c=a.i(p.d)(n),c.setAttr("activable",!0),l=c.findOne(".shapeGroup"),l.setAttr("_isDrawn",!1),r.add(c)):c=l.findAncestor(".shapeWrap");var u=l.findOne(".mainShape"),f=e.scale();if(u){var g={width:Math.abs(t.x/f.x-u.getX()),height:Math.abs(t.y/f.y-u.getY())};if(u.setAttrs(g),i)if(u.getWidth()<8||u.getHeight()<8)c.destroy(),console.log("图形尺寸过小，取消绘制");else{if(n.style.mainShape.backgroundImage)if("no-repeat"===n.style.mainShape.fillPatternRepeat){var m=u.x()+(u.getWidth()-n.style.mainShape.backgroundImage.width)/2,v=u.y()+(u.getHeight()-n.style.mainShape.backgroundImage.height)/2,S=new Image;S.onload=function(){var e=new Konva.Image({name:"fillicon",x:m,y:v,width:n.style.mainShape.backgroundImage.width,height:n.style.mainShape.backgroundImage.height,image:S,draggable:!1});l.add(e),l.draw()};var y=n.style.mainShape.backgroundImage.src;S.src=y}else{var w=new Image(n.style.mainShape.backgroundImage.width,n.style.mainShape.backgroundImage.height);w.onload=function(){u.setAttr("fillPatternImage",w),l.draw()},w.src=n.style.mainShape.backgroundImage.src}n.style.textShape&&o(c,n),u.setOpacity(1),u.setFillPriority("pattern"),l.setAttr("_isDrawn",!0),c.on("dblclick",function(t){e.fire("evt_stage_element_dblclick",c)}),c.on("mousedown",function(t){var a=t.evt;2===a.button&&e.fire("evt_stage_element_contextmenu",{event:a,element:c})}),c.on("mouseenter",function(t){e.fire("evt_stage_element_mouseenter",c)}),c.on("mouseleave",function(t){e.fire("evt_stage_element_mouseleave",c)}),e.fire("evt_stage_element_changed",{changeType:"add",element:c})}}else u=new Konva.Rect(d()({name:"mainShape",x:t.x/f.x,y:t.y/f.y,width:0,height:0,opacity:.3,dashEnabled:!1,draggable:!1},n.style.mainShape)),u.on("evt-active",s),l.add(u);r.draw(),window.plotstack.execute(new window.InsertCommand(e,".shapesLayer",l))}function o(e,t){var a=e.findOne(".shapeGroup");t.style.textShape.forEach(function(e){var t=new Konva.Text(d()({name:"textShape",draggable:!1},e));t.on("evt-active",s),a.add(t)}),c(a)}function r(e,t,a){var n=t.findAncestor(".shapeWrap"),i=n.findOne(".shapeGroup"),o=i.findOne(".mainShape"),r=i.find(".textShape"),s=new window.EditCommand(e,".shapesLayer");if(s.setOldValue(i),o)for(var l in a.mainShape)if(a.mainShape.hasOwnProperty(l)){var c=a.mainShape[l];o.setAttr(l,c)}if(r){for(var u in a.textShape)if(a.textShape.hasOwnProperty(u)){var d=a.textShape[u];r.setAttr(u,d)}a.textShape.fields.forEach(function(e){r.forEach(function(t){t.getAttr("alias")===e.alias&&(t.setAttr("text",e.value),t.setAttr("fontSize",e.fontSize),t.setAttr("fontStyle",e.fontStyle),t.setAttr("fontFamily",e.fontFamily))})})}e.findOne(".shapesLayer").draw(),s.setNewValue(i),window.plotstack.execute(s)}function s(e){var t=e.getLayer(),n=e.getStage(),i=e.findAncestor(".shapeWrap"),o=e.findAncestor(".shapeGroup"),r=o.find(".textShape"),s=i.findOne(".interactiveGroup");if(i.getAttr("activable")&&!i.getAttr("actived")){a.i(p.e)(n);var l=o.findOne(".mainShape"),u=new Konva.Transformer({rotateEnabled:!1,enabledHandlers:["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"]});u.on("dragmove",function(e){r.setAttr("visible",!1),l.setFillPriority("color"),l.setOpacity(.5),t.draw()}),u.on("dragend",function(e){r.setAttr("visible",!0),l.setFillPriority("pattern"),l.setOpacity(1),c(o),t.draw()}),u.attachTo(o),s.add(u),o.setDraggable(!0),i.setAttr("actived",!0),a.i(p.f)(i,"show"),a.i(p.g)(n)}}function l(e){var t=e.getStage(),a=e.getAttr("_shapeCfg"),n=e.findOne(".shapeGroup"),i=n.findOne(".mainShape"),o=n.findOne(".textShape");if(i.on("evt-active",s),e.on("dblclick",function(a){t.fire("evt_stage_element_dblclick",e)}),e.on("mouseenter",function(a){var n=a.evt;t.fire("evt_stage_element_mouseenter",{event:n,element:e})}),e.on("mouseleave",function(a){var n=a.evt;t.fire("evt_stage_element_mouseleave",{event:n,element:e})}),e.on("mousedown",function(a){var n=a.evt;2===n.button&&t.fire("evt_stage_element_contextmenu",{event:n,element:e})}),o&&o.on("evt-active",s),a.style.mainShape.backgroundImage)if("no-repeat"===a.style.mainShape.fillPatternRepeat){var r=n.findOne(".fillicon");if(r){var l=new Image;l.onload=function(){r.image(l),n.draw()};var c=a.style.mainShape.backgroundImage.src;l.src=c}}else{var u=new Image;u.onload=function(){i.setAttr("fillPatternImage",u),n.draw()},u.src=a.style.mainShape.backgroundImage.src}}function c(e){var t=e.findOne(".mainShape"),a=e.find(".textShape"),n=e.getAttr("scaleX"),i=e.getAttr("scaleY"),o={x:t.getX(),y:t.getY(),width:t.getWidth(),height:t.getHeight()},r=o.width-8,s=0;a.forEach(function(e){s+=e.getHeight(),e.setAttrs({width:r*n,scaleX:1/n,scaleY:1/i}),"code"===e.getAttr("alias")?e.setAttrs({x:o.x+o.width/2-r/2,y:o.y}):"name"===e.getAttr("alias")&&e.setAttrs({x:o.x+o.width/2-r/2,y:o.y+o.height/2-e.getHeight()/2})});var l=a.findIndex(function(e){return"title"===e.getAttr("alias")});l>=0&&(o.height*i<s+20?a[l].setAttr("visible",!1):a[l].setAttr("visible",!0))}var u=a(2),d=a.n(u),h=a(7),p=a(11);t.a={init:n,applyFeature:r,reloadShape:l}},function(e,t,a){"use strict";function n(e){var t=e;return"string"==typeof t&&(t=JSON.parse(e)),i(t),t.children.find(function(e){return"shapesLayer"===e.attrs.name}).children.forEach(function(e){var t=e.attrs;t&&"shapeWrap"===t.name&&!t.shapeUuid&&(t.shapeUuid=l()())}),t}function i(e){var t=e.children,a=t.find(function(e){return"shapesLayer"===e.attrs.name}),n=[];a.children.forEach(function(e){n.push(e)}),r.a.commit("updateStageElements",n)}function o(e){var t=window.ploterStage,a=t.findOne(".shapesLayer"),n=null;if(a.children)for(var i=0;i<a.children.length;i++){var o=a.children[i],r=o.getAttr("shapeUuid");r===e&&(n=o)}return n}t.a=n,t.b=i,t.c=o;var r=a(17),s=a(25),l=a.n(s)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},,,,,,,,,,,,function(e,t,a){a(115);var n=a(0)(a(49),a(139),"data-v-23808063",null);e.exports=n.exports},function(e,t,a){var n=a(0)(a(50),a(141),null,null);e.exports=n.exports},function(e,t,a){var n=a(0)(a(51),a(144),null,null);e.exports=n.exports},function(e,t,a){var n=a(0)(a(52),a(140),null,null);e.exports=n.exports},function(e,t,a){var n=a(0)(a(53),a(145),null,null);e.exports=n.exports},function(e,t,a){a(118);var n=a(0)(a(54),a(146),null,null);e.exports=n.exports},function(e,t,a){a(114);var n=a(0)(a(55),a(138),"data-v-20b2bd6a",null);e.exports=n.exports},function(e,t,a){a(116);var n=a(0)(a(56),a(142),"data-v-48a6d781",null);e.exports=n.exports},function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-ploter-widget-move"},[a("div",{staticClass:"up-btn",on:{click:function(t){e.onMoveTo("up")}}}),e._v(" "),a("div",{staticClass:"right-btn",on:{click:function(t){e.onMoveTo("right")}}}),e._v(" "),a("div",{staticClass:"left-btn",on:{click:function(t){e.onMoveTo("left")}}}),e._v(" "),a("div",{staticClass:"down-btn",on:{click:function(t){e.onMoveTo("down")}}})])},staticRenderFns:[]}},function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Modal",{staticClass:"component-business-shape-attribute",attrs:{title:"展位信息",closable:!1,"mask-closable":!1},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[a("Form",{attrs:{model:e.formData,"label-width":80}},[a("FormItem",{attrs:{label:"展位编号"}},[a("Input",{model:{value:e.formData.code,callback:function(t){e.$set(e.formData,"code",t)},expression:"formData.code"}})],1),e._v(" "),a("FormItem",{attrs:{label:"编号式样"}},[a("Row",[a("Col",{attrs:{span:"12"}},[a("Select",{model:{value:e.formData.codeFontFamily,callback:function(t){e.$set(e.formData,"codeFontFamily",t)},expression:"formData.codeFontFamily"}},e._l(e.baseFontOptions.fontFamily,function(t){return a("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.name))])}))],1),e._v(" "),a("Col",{staticStyle:{margin:"0 10px"},attrs:{span:"5"}},[a("Select",{model:{value:e.formData.codeFontSize,callback:function(t){e.$set(e.formData,"codeFontSize",t)},expression:"formData.codeFontSize"}},e._l(e.baseFontOptions.fontSize,function(t){return a("Option",{key:t,attrs:{value:t}},[e._v(e._s(t)+"px")])}))],1),e._v(" "),a("Col",{attrs:{span:"5"}},[a("Select",{model:{value:e.formData.codeFontStyle,callback:function(t){e.$set(e.formData,"codeFontStyle",t)},expression:"formData.codeFontStyle"}},e._l(e.baseFontOptions.fontStyle,function(t){return a("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.name))])}))],1)],1)],1),e._v(" "),a("FormItem",{attrs:{label:"展位名称"}},[a("Input",{model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),e._v(" "),a("FormItem",{attrs:{label:"名称式样"}},[a("Row",[a("Col",{attrs:{span:"12"}},[a("Select",{model:{value:e.formData.nameFontFamily,callback:function(t){e.$set(e.formData,"nameFontFamily",t)},expression:"formData.nameFontFamily"}},e._l(e.baseFontOptions.fontFamily,function(t){return a("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.name))])}))],1),e._v(" "),a("Col",{staticStyle:{margin:"0 10px"},attrs:{span:"5"}},[a("Select",{model:{value:e.formData.nameFontSize,callback:function(t){e.$set(e.formData,"nameFontSize",t)},expression:"formData.nameFontSize"}},e._l(e.baseFontOptions.fontSize,function(t){return a("Option",{key:t,attrs:{value:t}},[e._v(e._s(t)+"px")])}))],1),e._v(" "),a("Col",{attrs:{span:"5"}},[a("Select",{model:{value:e.formData.nameFontStyle,callback:function(t){e.$set(e.formData,"nameFontStyle",t)},expression:"formData.nameFontStyle"}},e._l(e.baseFontOptions.fontStyle,function(t){return a("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.name))])}))],1)],1)],1),e._v(" "),a("FormItem",{attrs:{label:"展位类型"}},[a("Row",[a("Col",{attrs:{span:"9"}},[a("Select",{model:{value:e.formData.boothType,callback:function(t){e.$set(e.formData,"boothType",t)},expression:"formData.boothType"}},[a("Option",{attrs:{value:"标准展位"}},[e._v("标准展位")]),e._v(" "),a("Option",{attrs:{value:"室外光地展位"}},[e._v("室外光地展位")])],1)],1),e._v(" "),a("Col",{staticStyle:{"text-align":"right","padding-right":"10px"},attrs:{span:"6"}},[e._v("\n                    出口类型\n                ")]),e._v(" "),a("Col",{attrs:{span:"9"}},[a("Select",{model:{value:e.formData.entryType,callback:function(t){e.$set(e.formData,"entryType",t)},expression:"formData.entryType"}},[a("Option",{attrs:{value:"一面开"}},[e._v("一面开")]),e._v(" "),a("Option",{attrs:{value:"两面开"}},[e._v("两面开")]),e._v(" "),a("Option",{attrs:{value:"三面开"}},[e._v("三面开")]),e._v(" "),a("Option",{attrs:{value:"全开"}},[e._v("全开")])],1)],1)],1)],1),e._v(" "),a("FormItem",{attrs:{label:"横向长度"}},[a("Row",[a("Col",{attrs:{span:"9"}},[a("InputNumber",{attrs:{min:0,formatter:function(e){return e+" 米"},parser:function(e){return e.replace(" 米","")}},model:{value:e.formData.lateralLength,callback:function(t){e.$set(e.formData,"lateralLength",t)},expression:"formData.lateralLength"}})],1),e._v(" "),a("Col",{staticStyle:{"text-align":"right","padding-right":"10px"},attrs:{span:"6"}},[e._v("\n                    纵向长度\n                ")]),e._v(" "),a("Col",{attrs:{span:"9"}},[a("InputNumber",{attrs:{min:0,formatter:function(e){return e+" 米"},parser:function(e){return e.replace(" 米","")}},model:{value:e.formData.verticalLength,callback:function(t){e.$set(e.formData,"verticalLength",t)},expression:"formData.verticalLength"}})],1)],1)],1),e._v(" "),a("FormItem",{attrs:{label:"展位面积"}},[a("InputNumber",{attrs:{min:0,formatter:function(e){return e+" 平方米"},parser:function(e){return e.replace(" 平方米","")}},model:{value:e.formData.area,callback:function(t){e.$set(e.formData,"area",t)},expression:"formData.area"}})],1),e._v(" "),a("FormItem",{attrs:{label:"展位状态"}},[a("Select",{model:{value:e.formData.status,callback:function(t){e.$set(e.formData,"status",t)},expression:"formData.status"}},e._l(e.dataStatus,function(t){return a("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.name))])}))],1)],1),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{on:{click:function(t){e.$emit("close")}}},[e._v("取消")]),e._v(" "),a("Button",{on:{click:e.saveData}},[e._v("确定")])],1)],1)},staticRenderFns:[]}},function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-status-bar-current-wrap"},[null!=e.plotTool?a("div",{staticClass:"app-status-bar-current"},[e.plotTool.src?a("img",{staticClass:"app-status-bar-current-icon",attrs:{src:e.plotTool.src+".png"}}):e._e(),e._v(" "),a("h6",{staticClass:"app-status-bar-current-title"},[e._v(e._s(e.plotTool.name))]),e._v(" "),a("div",{staticClass:"app-status-bar-current-tip"},[e.isLine?[e._v("\n                按下 "),a("code",[e._v("ESC")]),e._v(" 键结束绘制，\n            ")]:e._e(),e._v("\n            单击鼠标右键退出当前工具\n        ")],2)]):a("div",{staticClass:"app-status-bar-current"},[a("div",{staticClass:"app-status-bar-current-tip"},[e._v("当前未选中标绘工具")])])])},staticRenderFns:[]}},function(e,t){e.exports={render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("AttributeModule",{attrs:{show:e.attributeModule.show,data:e.attributeModule.data},on:{close:e.handlerModelCancel}})},staticRenderFns:[]}},function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.stage?a("div",{staticClass:"app-ploter-widget-scale"},[a("div",{staticClass:"enlarge-btn",on:{click:e.onScaleEnlarge}}),e._v(" "),a("div",{staticClass:"narrow-btn",on:{click:e.onScaleNarrow}}),e._v(" "),a("div",{staticClass:"reset-btn",on:{click:e.onResetScale}})]):e._e()},staticRenderFns:[]}},function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("transition",{attrs:{name:"bounce"}},[a("router-view")],1)},staticRenderFns:[]}},function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-status-bar-coordinate-wrap"},[null!=e.coordinate?a("div",{staticClass:"app-status-bar-coordinate"},[a("div",{staticClass:"app-status-bar-coordinate-system"},[e._v("坐标系："+e._s(e.coordinate.system))]),e._v(" "),null!=e.coordinate.x||null!=e.coordinate.y?a("div",{staticClass:"app-status-bar-coordinate-value"},[a("span",[e._v("X："+e._s(e.viewCoordinate.x)+"px")]),e._v(" "),a("span",[e._v("Y："+e._s(e.viewCoordinate.y)+"px")])]):a("div",{staticClass:"app-status-bar-coordinate-tip"},[e._v("\n            鼠标当前位于画布之外\n        ")])]):e._e()])},staticRenderFns:[]}},function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.stage?a("div",{staticClass:"app-status-bar-stageattr-wrap"},[a("div",{staticClass:"app-status-bar-stageattr"},[a("div",{staticStyle:{flex:"1"}}),e._v(" "),e._v("\n        缩放:\n        "),a("Slider",{staticClass:"app-status-bar-stageattr-zoom-slider",attrs:{max:2,min:.2,step:.2,"tip-format":e.tipFormat},on:{"on-change":e.onScaleChange},model:{value:e.scaleLevel,callback:function(t){e.scaleLevel=t},expression:"scaleLevel"}}),e._v(" "),a("Button",{staticStyle:{"margin-left":"8px"},attrs:{size:"small",type:"text",icon:"ios-undo"},on:{click:e.onResetScale}})],1)]):e._e()},staticRenderFns:[]}},function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Layout",{attrs:{id:"AppViewport"}},[a("Content",{staticClass:"app-body"},[a("div",{staticClass:"app-ploter-main"},[a("div",{staticClass:"app-ploter-main-body"},[a("div",{ref:"plotStage",staticClass:"app-ploter-main-canvas"}),e._v(" "),a("div",{staticClass:"app-ploter-main-mask"})])]),e._v(" "),a("ComponentsBusinessShape",{on:{evt_stage_element_feature_changed:e.onFeatureChange,evt_stage_element_remove:e.doShapeDelete}})],1),e._v(" "),a("appPloterWidgetMove"),e._v(" "),e.stage?a("AppPloterWidgetScale",{attrs:{stage:e.stage},on:{evtStageCfgChanged:e.onStageCfgChanged,evtStageScaleChanged:e.onStageScaleChanged,evtStageScaleReset:e.onStageScaleReset}}):e._e()],1)},staticRenderFns:[]}},,function(e,t){e.exports=["#311B92","#512DA8","#673AB7","#9575CD","#D1C4E9"]},function(e,t){e.exports={fontFamily:[{name:"宋体",value:"simsun"},{name:"黑体",value:"simhei"},{name:"楷体,楷体_GB2312",value:"楷体,楷体_GB2312"},{name:"隶书",value:"隶书"},{name:"幼圆",value:"幼圆"},{name:"微软雅黑",value:"Microsoft Yahei"},{name:"Arial",value:"Arial"},{name:"Arial Black",value:"Arial Black"},{name:"Comic Sans MS",value:"Comic Sans MS"},{name:"Courier",value:"Courier"},{name:"System",value:"System"},{name:"Times New Roman",value:"Times New Roman"},{name:"Verdana",value:"Verdana"},{name:"Georgia",value:"Georgia"},{name:"Calibri",value:"Calibri"}],fontSize:[10,12,14,16,18,24,32,48],fontStyle:[{name:"正常",value:"normal"},{name:"粗体",value:"bold"},{name:"斜体",value:"italic"}]}},function(e,t){e.exports={attrs:{width:800,height:600,mplot:"0.4.0"},className:"Stage",children:[{attrs:{name:"backgroundLayer"},className:"Layer",children:[]},{attrs:{name:"shapesLayer"},className:"Layer",children:[]}]}}],[59]);